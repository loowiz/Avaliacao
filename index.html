<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o de Recupera√ß√£o: UC Linguagem de Programa√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }

        .hidden { display: none !important; }
        .block { display: block; }
        .text-center { text-align: center; }

        .no-select {
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .question-card { transition: all 0.3s ease; }
        .question-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }

        @keyframes pulse-red {
            0% { color: white; }
            50% { color: #ffcccc; }
            100% { color: white; }
        }
        .timer-warning { animation: pulse-red 1s infinite; font-weight: bold; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }
        .penalty-shake { animation: shake 0.4s; background-color: #ef4444 !important; }
    </style>
</head>
<body class="min-h-screen py-8 px-4 sm:px-6 lg:px-8 no-select" oncontextmenu="return false;">

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg relative">
        <div id="welcome-screen" class="p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-blue-700">Avalia√ß√£o de Recupera√ß√£o</h1>
                <p class="text-gray-600 mt-2 text-lg">Situa√ß√£o de Aprendizagem 3</p>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
                <h2 class="text-lg font-bold text-blue-800 mb-2">üëã Ol√°, estudante!</h2>
                <p class="text-gray-700">
                    Voc√™ est√° prestes a iniciar sua avalia√ß√£o. Antes de come√ßar, leia atentamente as instru√ß√µes abaixo.
                    <br><strong>Dica:</strong> Se voc√™ n√£o se sentir preparado(a), utilize os links de revis√£o abaixo e retorne a esta p√°gina em outro momento.
                </p>
            </div>
            
            <div class="mb-8 bg-gray-50 p-6 rounded-lg border border-gray-200 shadow-sm">
                <h3 class="text-md font-bold text-gray-700 mb-4 uppercase tracking-wide border-b pb-2">1. Identifica√ß√£o</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Nome Completo</label>
                        <input type="text" id="studentName" class="mt-1 w-full p-3 border rounded-md focus:ring-blue-500" placeholder="Digite seu nome...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Turma</label>
                        <input type="text" id="studentClass" class="mt-1 w-full p-3 border rounded-md focus:ring-blue-500" placeholder="Ex: 1¬∫ Mecatr√¥nica">
                    </div>
                </div>
            </div>
            <div class="mb-8 bg-white border border-gray-200 p-6 rounded-lg shadow-sm">
                <h3 class="text-md font-bold text-blue-800 mb-4 flex items-center gap-2">
                    üéì Material de Estudo (Revis√£o)
                </h3>
                <p class="text-sm text-gray-600 mb-4">Acesse os links oficiais para revisar antes de iniciar. O tempo s√≥ conta ap√≥s clicar em "Iniciar".</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                    <div>
                        <h4 class="font-bold text-gray-700 mb-2">L√≥gica e Programa√ß√£o</h4>
                        <ul class="list-disc pl-4 space-y-1 text-blue-600">
                            <li><a href="https://youtu.be/ZaGx0ll0pnU" target="_blank" class="hover:underline">Estruturas Condicionais (If/Else)</a></li>
                            <li><a href="https://youtu.be/MeAA0oX6LyE" target="_blank" class="hover:underline">Entradas Digitais</a></li>
                            <li><a href="https://youtu.be/hRtF2UCNatM" target="_blank" class="hover:underline">Sa√≠das Digitais</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-700 mb-2">Componentes</h4>
                        <ul class="list-disc pl-4 space-y-1 text-blue-600">
                            <li><a href="https://youtu.be/MQlRQaOtkoM" target="_blank" class="hover:underline">Teclado Matricial</a></li>
                            <li><a href="https://youtu.be/0yxg3Z_Gc60" target="_blank" class="hover:underline">Display LCD</a></li>
                            <li><a href="https://projecthub.arduino.cc/arcaegecengiz/using-dht11-12f621" target="_blank" class="hover:underline">Sensor DHT11</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="bg-yellow-50 border border-yellow-200 p-5 rounded-lg shadow-sm mb-8">
                <h3 class="text-md font-bold text-red-700 mb-2">‚ö†Ô∏è Regras de Seguran√ßa</h3>
                <ul class="text-sm text-gray-700 list-disc pl-5">
                    <li><strong>Proibido sair da aba:</strong> O sistema registra se voc√™ mudar de janela.</li>
                    <li><strong>Proibido copiar:</strong> A sele√ß√£o de texto est√° bloqueada.</li>
                    <li>‚è≥ <strong>Tempo Limite:</strong> Voc√™ ter√° <strong>30 minutos</strong> corridos.</li>
                    <li><strong>10 Penalidades = BLOQUEIO:</strong> A prova ser√° encerrada automaticamente.</li>
                </ul>
            </div>

            <button onclick="startExam()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg shadow-lg text-lg transition transform hover:scale-[1.01]">
                üöÄ INICIAR AVALIA√á√ÉO AGORA
            </button>
        </div>
        <div id="exam-screen" class="hidden">
            <div class="bg-blue-600 px-6 py-4 text-white flex flex-col md:flex-row justify-between items-center sticky top-0 z-50 shadow-md rounded-t-xl gap-4">
                <div>
                    <h1 class="text-lg md:text-xl font-bold">Avalia√ß√£o em Andamento</h1>
                    <p class="text-blue-100 text-xs mt-1" id="student-display">Aluno: ...</p>
                </div>
                <div class="flex gap-4">
                    <div id="penalty-box" class="bg-red-800 px-3 py-2 rounded-lg text-center min-w-[100px]">
                        <p class="text-[10px] text-red-200 uppercase">Penalidades</p>
                        <div class="text-lg font-mono font-bold"><span id="penalty-display">0</span>/10</div>
                    </div>
                    <div class="bg-blue-800 px-3 py-2 rounded-lg text-center min-w-[100px]">
                        <p class="text-[10px] text-blue-200 uppercase">Tempo</p>
                        <div id="timer-display" class="text-lg font-mono font-bold">00:00</div>
                    </div>
                </div>
            </div>
            <div id="quiz-container" class="p-6 space-y-6 bg-gray-50 min-h-[500px]"></div>
            <div class="p-6 bg-white border-t border-gray-200 flex justify-end gap-4 rounded-b-xl">
                <button onclick="finishQuiz()" id="btn-finish" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow">
                    Finalizar e Ver Nota
                </button>
                <button onclick="generatePDF()" id="btn-pdf" class="hidden bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg shadow flex items-center gap-2">
                    üìÑ Baixar Comprovante
                </button>
            </div>
            <div id="result-area" class="hidden p-6 bg-yellow-50 text-center border-t border-yellow-200">
                <h3 class="text-2xl font-bold text-gray-800">Nota: <span id="score-display" class="text-blue-600"></span>/100</h3>
                <p class="text-gray-600 mt-2">Clique no bot√£o "Baixar Comprovante" para salvar seu recibo de nota e enviar ao professor.</p>
            </div>
        </div>
    </div>

<script>

    const _k = "bcacbdccbbaacbabccbcbababbacaaabbbacbbaabbcaabacbbcbaaccbcbaacabbcaabbabaabbcbccbcabacbaaabbabcbabab";

    const fullQuestionBank = [
        // --- Arduino B√°sico ---
        { id: 0, q: "Qual fun√ß√£o do Arduino roda apenas uma vez quando a placa √© ligada?", options: ["loop()", "setup()", "main()", "start()"] },
        { id: 1, q: "Qual fun√ß√£o do Arduino √© executada repetidamente em ciclo infinito?", options: ["setup()", "repeat()", "loop()", "cycle()"] },
        { id: 2, q: "Para configurar um pino como sa√≠da de energia, qual comando utilizamos?", options: ["pinMode(pino, OUTPUT)", "pinMode(pino, INPUT)", "digitalWrite(pino, HIGH)", "analogWrite(pino, 255)"] },
        { id: 3, q: "Qual comando √© usado para ler o estado de um bot√£o digital?", options: ["analogRead()", "digitalWrite()", "digitalRead()", "pinMode()"] },
        { id: 4, q: "O que o comando 'delay(2000)' faz no c√≥digo?", options: ["Pausa por 2000s", "Pausa por 2 segundos", "Reinicia o Arduino", "Espera um bot√£o"] },
        { id: 5, q: "Em C++, como declaramos uma vari√°vel para n√∫meros inteiros?", options: ["float", "String", "boolean", "int"] },
        { id: 6, q: "Qual tipo de vari√°vel √© ideal para temperatura '25.5'?", options: ["int", "char", "float", "long"] },
        { id: 7, q: "O que significa o s√≠mbolo '//' no c√≥digo?", options: ["In√≠cio de fun√ß√£o", "Divis√£o", "Coment√°rio de uma linha", "Fim de instru√ß√£o"] },
        { id: 8, q: "Qual operador verifica igualdade no 'if'?", options: ["=", "==", "===", "!="] },
        { id: 9, q: "Qual operador l√≥gico representa 'E' (AND)?", options: ["||", "!", "&&", "**"] },
        { id: 10, q: "Qual operador l√≥gico representa 'OU' (OR)?", options: ["&&", "||", "??", "!"] },
        { id: 11, q: "O s√≠mbolo '!' antes de uma vari√°vel booleana serve para:", options: ["Confirmar", "Inverter (N√ÉO l√≥gico)", "Transformar em int", "Apagar"] },
        { id: 12, q: "Qual biblioteca √© essencial para o Display LCD 16x2?", options: ["<Keypad.h>", "<DHT.h>", "<LiquidCrystal.h>", "<Servo.h>"] },
        { id: 13, q: "Para incluir uma biblioteca, usamos:", options: ["#define", "#include", "import", "using"] },
        { id: 14, q: "O comando 'Serial.begin(9600)' serve para:", options: ["Ligar o LCD", "Iniciar comunica√ß√£o serial", "Definir motor", "Configurar PWM"] },
        { id: 15, q: "Qual pontua√ß√£o finaliza uma instru√ß√£o em C++?", options: [":", ".", ";", ","] },
        { id: 16, q: "O que acontece se esquecer de fechar uma chave '}'?", options: ["Roda normal", "Erro de compila√ß√£o", "Trava o Arduino", "Ignora a fun√ß√£o"] },
        { id: 17, q: "A fun√ß√£o 'lcd.clear()' serve para:", options: ["Desligar LCD", "Luz de fundo", "Limpar a tela", "Reiniciar"] },
        { id: 18, q: "O que 'lcd.setCursor(0, 1)' faz?", options: ["Vai p/ col 0, lin 0", "Vai p/ col 0, lin 1 (linha 2)", "Escreve 0 e 1", "Limpa linha 1"] },
        { id: 19, q: "Para concatenar texto em uma String, usamos:", options: ["*", "-", "+", "%"] },

        // --- Catraca / Teclado ---
        { id: 20, q: "No projeto da Catraca, qual componente √© usado para senha?", options: ["LDR", "Ultrass√¥nico", "Teclado 4x4", "Potenci√¥metro"] },
        { id: 21, q: "Qual biblioteca facilita o uso do teclado matricial?", options: ["Matrix.h", "Keypad.h", "Button.h", "Input.h"] },
        { id: 22, q: "Como comparar se a senha digitada √© igual √† correta (String)?", options: ["texto.compare()", "texto.check()", "texto.equals()", "texto.is()"] },
        { id: 23, q: "Na Catraca, a tecla '#' foi usada para:", options: ["Apagar", "Digitar zero", "Confirmar (Enter)", "Reiniciar"] },
        { id: 24, q: "Na Catraca, a tecla '*' foi usada para:", options: ["Confirmar", "Cancelar/Limpar", "Ligar LED", "Digitar letra"] },
        { id: 25, q: "O que √© um 'LCD Keypad Shield'?", options: ["Escudo f√≠sico", "Placa com LCD e bot√µes acoplada", "Sensor t√©rmico", "Software"] },
        { id: 26, q: "Para exibir '*' no lugar da senha, usamos:", options: ["lcd.print('*')", "lcd.noDisplay()", "lcd.hide()", "Serial.print('*')"] },
        { id: 27, q: "Qual vari√°vel armazenou a senha digitada?", options: ["int", "float", "String", "char"] },
        { id: 28, q: "O sistema da Trava √© 'biest√°vel'. Isso significa:", options: ["Tem 2 Arduinos", "Alterna entre 2 estados est√°veis", "Usa 2 baterias", "Funciona 2s"] },
        { id: 29, q: "O operador tern√°rio 'cond ? v1 : v2' substitui:", options: ["for", "while", "if...else simples", "switch"] },
        { id: 30, q: "Se 'travado' √© false, o que '!travado' retorna?", options: ["false", "true", "null", "erro"] },
        { id: 31, q: "Para limpar a vari√°vel senha, atribu√≠mos:", options: ["0", "null", "\"\" (vazio)", "false"] },
        { id: 32, q: "Quantos pinos digitais controlam as linhas do teclado 4x4?", options: ["2", "4", "8", "16"] },
        { id: 33, q: "O mapeamento das teclas usa:", options: ["Matriz (Array 2D)", "Lista simples", "Vari√°vel int", "Sensor anal√≥gico"] },
        { id: 34, q: "Na Trava, Rel√© em HIGH geralmente significa:", options: ["Aberto", "Desligado (Fechado)", "Curto", "Queimado"] },

        // --- Ultrass√¥nico / Alarme ---
        { id: 35, q: "Qual sensor foi usado no Alarme de Intrus√£o?", options: ["DHT11", "LDR", "HC-SR04", "LM35"] },
        { id: 36, q: "O pino 'Trig' do ultrass√¥nico serve para:", options: ["Receber eco", "Enviar pulso", "Alimentar", "Aterrar"] },
        { id: 37, q: "O pino 'Echo' do ultrass√¥nico serve para:", options: ["Enviar som", "Receber eco", "Configurar", "Ligar LED"] },
        { id: 38, q: "A velocidade do som usada no c√°lculo √© aprox.:", options: ["340 m/s", "100 km/h", "300.000 km/s", "10 m/s"] },
        { id: 39, q: "Por que dividimos o tempo do som por 2?", options: ["Converter metros", "Porque o som vai e volta", "Reduzir ru√≠do", "Constante Arduino"] },
        { id: 40, q: "Qual fun√ß√£o mede a dura√ß√£o do pulso no Echo?", options: ["digitalRead", "analogRead", "pulseIn()", "time"] },
        { id: 41, q: "Para que serve 'delayMicroseconds(10)' no Trig?", options: ["Pausar 10s", "Gerar pulso de disparo", "Esperar LCD", "Reiniciar"] },
        { id: 42, q: "Se a dist√¢ncia for menor que o limite, o alarme:", options: ["Desliga", "Ativa (LED+Rel√©)", "Reinicia", "Para de ler"] },
        { id: 43, q: "O sensor ultrass√¥nico usa ondas de:", options: ["Baixa freq", "Alta frequ√™ncia (inaud√≠veis)", "Infravermelho", "R√°dio"] },
        { id: 44, q: "O M√≥dulo de Rel√© serve para:", options: ["Medir", "Controlar cargas de pot√™ncia", "Armazenar", "Substituir Arduino"] },
        { id: 45, q: "Em rel√©s ativo-baixo, sinal LOW faz o qu√™?", options: ["Desliga", "Liga (Ativa)", "Queima", "Nada"] },
        { id: 46, q: "Por que usar 'long' para a dura√ß√£o do pulso?", options: ["√â decimal", "√â texto", "Pode ser n√∫mero grande", "√â negativo"] },

        // --- LED RGB ---
        { id: 47, q: "Um LED RGB emite:", options: ["S√≥ vermelho", "S√≥ branco", "V√°rias cores misturadas", "Som"] },
        { id: 48, q: "Para controlar intensidade do LED (PWM), usamos:", options: ["digitalWrite", "analogWrite()", "digitalRead", "tone"] },
        { id: 49, q: "Pinos PWM no Arduino t√™m qual s√≠mbolo?", options: ["A", "~", "V", "Nenhum"] },
        { id: 50, q: "Amarelo no RGB √© mistura de:", options: ["Vermelho+Azul", "Verde+Azul", "Vermelho+Verde", "S√≥ Verde"] },
        { id: 51, q: "O que √© 'Debounce' em bot√µes?", options: ["Pular", "Evitar ru√≠do/leituras falsas", "Ligar no 5V", "Queimar"] },
        { id: 52, q: "INPUT_PULLUP faz o bot√£o ler o qu√™ ao pressionar?", options: ["HIGH", "LOW (com resistor interno)", "Precisa resistor externo", "Sa√≠da"] },
        { id: 53, q: "A estrutura 'enum' serve para:", options: ["Contar", "Definir estados nomeados", "Loop", "LCD"] },
        { id: 54, q: "Valores de PWM variam de:", options: ["0-1023", "0-100", "0-255", "-128 a 127"] },
        { id: 55, q: "Se usarmos analogWrite(pino, 0), o LED:", options: ["Brilha muito", "Pisca", "Apaga", "Muda cor"] },
        { id: 56, q: "Vantagem de usar fun√ß√µes no c√≥digo:", options: ["Mais lento", "Organiza√ß√£o e clareza", "Mais mem√≥ria", "Nenhuma"] },

        // --- DHT11 ---
        { id: 57, q: "O DHT11 mede:", options: ["Luz", "Temp. e Umidade", "Dist√¢ncia", "Press√£o"] },
        { id: 58, q: "Intervalo m√≠nimo de leitura do DHT11:", options: ["10ms", "500ms", "2 segundos", "1 min"] },
        { id: 59, q: "A fun√ß√£o 'isnan()' verifica:", options: ["Se √© n√∫mero inv√°lido (erro)", "Se √© zero", "Se desligado", "Se inteiro"] },
        { id: 60, q: "Unidade de temperatura padr√£o do DHT11:", options: ["Fahrenheit", "Kelvin", "Celsius", "Volts"] },
        { id: 61, q: "Exibir float com 1 casa decimal:", options: ["lcd.print(v, 1)", "lcd.print(v, 0)", "lcd.dec(v)", "lcd.one(v)"] },
        { id: 62, q: "Umidade acima do limite aciona:", options: ["Desligamento", "Exaustor (Rel√©)", "Apaga LCD", "M√∫sica"] },
        { id: 63, q: "Comando para ler temperatura:", options: ["dht.read()", "dht.get()", "dht.readTemperature()", "analogRead"] },
        { id: 64, q: "O que √© 'Histerese'?", options: ["Erro", "Faixa de toler√¢ncia p/ evitar oscila√ß√£o", "Cabo", "Velocidade"] },
        { id: 65, q: "Pino de dados do DHT11 no projeto:", options: ["0", "1", "40", "A0"] },
        { id: 66, q: "Se o sensor falhar, o c√≥digo:", options: ["Trava", "Avisa 'Erro de Sensor'", "Reinicia", "Ignora"] },
        { id: 67, q: "Biblioteca DHT.h serve para:", options: ["Motores", "Comunica√ß√£o com sensor", "Teclado", "Sons"] },
        { id: 68, q: "Como foi definida a Umidade Cr√≠tica?", options: ["Constante float", "Vari√°vel int", "String", "Pino"] },
        { id: 69, q: "O comando 'dht.begin()' faz o qu√™?", options: ["L√™", "Inicializa o sensor", "Para", "Calibra"] },

        // --- LDR ---
        { id: 70, q: "O LDR √© um resistor que varia com:", options: ["Calor", "Press√£o", "Luz", "Som"] },
        { id: 71, q: "Com mais luz, a resist√™ncia do LDR:", options: ["Aumenta", "Diminui", "Igual", "Queima"] },
        { id: 72, q: "LDR liga em qual pino para medir intensidade?", options: ["Digital", "PWM", "Anal√≥gico (A8)", "VCC"] },
        { id: 73, q: "analogRead() retorna valores entre:", options: ["0-255", "0-1023", "0-1", "-5 a 5"] },
        { id: 74, q: "Fun√ß√£o para converter escalas (ex: 0-1023 p/ 0-100):", options: ["convert", "map()", "pulseIn", "transform"] },
        { id: 75, q: "Fun√ß√£o 'constrain()' serve para:", options: ["Limitar valor num intervalo", "Zerar", "Multiplicar", "Dividir"] },
        { id: 76, q: "No projeto de ilumina√ß√£o, se escurecer:", options: ["Rel√©s desligam", "Rel√©s ligam gradualmente", "LCD apaga", "Nada"] },
        { id: 77, q: "Para controlar 4 rel√©s, usamos:", options: ["4 vari√°veis", "Array (vetor) e loop", "4 Arduinos", "Matriz"] },
        { id: 78, q: "O que √© divisor de tens√£o no LDR?", options: ["Ferramenta", "Circuito com resistor p/ ler voltagem", "Software", "Bateria"] },
        { id: 79, q: "T√©cnica para leitura est√°vel do LDR:", options: ["M√©dia M√≥vel", "Trocar Arduino", "Cola", "Mais voltagem"] },
        { id: 80, q: "map(valor, MIN, MAX, 0, 100) faz:", options: ["Mapa", "Regra de 3 (escala)", "Procura", "Apaga"] },
        { id: 81, q: "Feedback visual no projeto LDR:", options: ["Motor", "Sirene", "LED/LCD", "Calor"] },
        { id: 82, q: "Limites de luz para rel√©s eram:", options: ["Percentuais fixos", "Aleat√≥rios", "Texto", "Fun√ß√µes"] },
        { id: 83, q: "Para inverter estado (Toggle) digital:", options: ["!digitalRead(pino)", "write(0)", "analog(255)", "mode(OUTPUT)"] },
        { id: 84, q: "No escuro total, o valor anal√≥gico do LDR tende a:", options: ["Extremo (0 ou 1023)", "Zero fixo", "Aleat√≥rio", "512"] },

        // --- Geral ---
        { id: 85, q: "O que √© um Rel√©?", options: ["Sensor", "Interruptor eletromec√¢nico", "Gerador", "Mem√≥ria"] },
        { id: 86, q: "Por que usar resistor no LED?", options: ["Brilho", "Limitar corrente (n√£o queimar)", "Cor", "Polaridade"] },
        { id: 87, q: "Linguagem base do Arduino:", options: ["Python", "Java", "C++", "HTML"] },
        { id: 88, q: "GND significa:", options: ["Grande", "Terra (Ground/Negativo)", "Ganho", "Geral"] },
        { id: 89, q: "VCC ou 5V √©:", options: ["Dados", "Alimenta√ß√£o Positiva", "Terra", "Entrada"] },
        { id: 90, q: "Serial Monitor serve para:", options: ["V√≠deo", "Ver dados enviados ao PC", "Gr√°fico", "Compilar"] },
        { id: 91, q: "Vari√°vel 'const int' muda no loop?", options: ["Sim", "N√£o, √© constante", "√Äs vezes", "Se reiniciar"] },
        { id: 92, q: "Diferen√ßa Digital x Anal√≥gico:", options: ["Digital (0/1) x Anal√≥gico (Cont√≠nuo)", "Nenhuma", "Anal√≥gico melhor", "Digital √°udio"] },
        { id: 93, q: "O que √© Protoboard?", options: ["Placa final", "Placa de ensaio (furos)", "Processador", "Bateria"] },
        { id: 94, q: "Bot√£o Reset serve para:", options: ["Apagar", "Reiniciar programa", "Desligar", "Salvar"] },
        { id: 95, q: "Serial.println() difere de print() pois:", options: ["Cor", "Pula linha", "R√°pido", "N√∫meros"] },
        { id: 96, q: "Resolu√ß√£o do ADC do Arduino Mega:", options: ["8 bits", "10 bits (0-1023)", "12 bits", "16 bits"] },
        { id: 97, q: "DHT11 √© digital ou anal√≥gico?", options: ["Anal√≥gico", "Digital (envia bits)", "Mec√¢nico", "Nenhum"] },
        { id: 98, q: "LED ligado invertido:", options: ["Pisca", "N√£o acende", "Explode", "Muda cor"] },
        { id: 99, q: "Objetivo da Rota√ß√£o por Esta√ß√µes:", options: ["Parado", "Passar por pontos com tarefas variadas", "Copiar", "Competir"] }
    ];


    let currentQuestions = [];
    let userAnswers = {};
    let isExamStarted = false;
    let isLocked = false;
    let penaltyCount = 0;
    const MAX_PENALTIES = 10;
    let timerInterval;
    let timeElapsed = 0;
    const timeLimit = 30 * 60; 

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function getCorrectAnswerIndex(questionId) {
        const charCode = _k.charCodeAt(questionId);
        return charCode - 97; 
    }

    function startExam() {
        try {
            const name = document.getElementById('studentName').value.trim();
            const turma = document.getElementById('studentClass').value.trim();

            if (!name || !turma) {
                alert("Por favor, preencha Nome e Turma.");
                return;
            }

            if (!confirm("Iniciar a prova? O tempo come√ßar√° a contar.")) return;

            document.getElementById('student-display').textContent = `Aluno: ${name} (${turma})`;
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('exam-screen').classList.remove('hidden');
            document.getElementById('exam-screen').classList.add('block'); // For√ßar display

            isExamStarted = true;
            generateQuiz();
            startTimer();
            window.scrollTo(0, 0);

        } catch (e) {
            alert("Erro ao iniciar: " + e.message);
        }
    }

    function generateQuiz() {
        const container = document.getElementById('quiz-container');
        container.innerHTML = '';
        userAnswers = {};


        const shuffled = shuffleArray([...fullQuestionBank]);
        currentQuestions = shuffled.slice(0, 20);

        currentQuestions.forEach((qObj, index) => {
            const div = document.createElement('div');
            div.className = 'bg-white p-6 rounded-lg border shadow-sm mb-4 question-card';
            
            let opts = '';
            qObj.options.forEach((opt, i) => {

                const safeOpt = opt.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                opts += `
                    <label class="flex items-center space-x-3 p-2 rounded hover:bg-blue-50 cursor-pointer">
                        <input type="radio" name="q${index}" value="${i}" class="h-5 w-5 text-blue-600" onchange="saveAnswer(${index}, ${i})">
                        <span class="text-gray-700">${safeOpt}</span>
                    </label>
                `;
            });

            div.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 mb-3">${index + 1}. ${qObj.q}</h3>
                <div class="space-y-2">${opts}</div>
                <div id="feedback-${index}" class="mt-2 font-bold hidden"></div>
            `;
            container.appendChild(div);
        });
    }

    function saveAnswer(idx, val) {
        userAnswers[idx] = val;
    }

    function startTimer() {
        const display = document.getElementById('timer-display');
        timerInterval = setInterval(() => {
            if (isLocked) return clearInterval(timerInterval);
            timeElapsed++;
            
            const m = Math.floor(timeElapsed / 60).toString().padStart(2, '0');
            const s = (timeElapsed % 60).toString().padStart(2, '0');
            display.textContent = `${m}:${s}`;

            if (timeElapsed >= timeLimit) lockQuiz("Tempo esgotado!");
        }, 1000);
    }

    function addPenalty(reason) {
        if (!isExamStarted || isLocked || document.getElementById('btn-finish').classList.contains('hidden')) return;
        
        penaltyCount++;
        document.getElementById('penalty-display').textContent = penaltyCount;
        
        const box = document.getElementById('penalty-box');
        box.classList.add('penalty-shake');
        setTimeout(() => box.classList.remove('penalty-shake'), 500);

        if (penaltyCount >= MAX_PENALTIES) lockQuiz("Muitas penalidades!");
        else alert(`‚ö†Ô∏è PENALIDADE (${penaltyCount}/${MAX_PENALTIES}): ${reason}`);
    }

    function lockQuiz(msg) {
        isLocked = true;
        clearInterval(timerInterval);
        document.querySelectorAll('input').forEach(i => i.disabled = true);
        alert(msg + "\nFinalize para gerar o PDF.");
    }

    document.addEventListener("visibilitychange", () => { if(document.hidden) addPenalty("Saiu da aba."); });
    document.addEventListener('copy', (e) => { if(isExamStarted) { e.preventDefault(); addPenalty("C√≥pia bloqueada."); } });
    document.addEventListener('contextmenu', (e) => { e.preventDefault(); return false; });
    document.addEventListener('keydown', (e) => {
        if(e.key == "F12" || (e.ctrlKey && (e.key == "u" || e.key == "s" || e.key == "p"))) {
            e.preventDefault();
            if(isExamStarted) addPenalty("Tecla proibida.");
        }
    });

    setInterval(() => {
        if (isExamStarted && !isLocked) {
            const t0 = Date.now();
            debugger;
            if (Date.now() - t0 > 100) addPenalty("Inspector aberto.");
        }
    }, 4000);

    function finishQuiz() {
        if (!isLocked && Object.keys(userAnswers).length < 20) {
            if(!confirm("Tem quest√µes em branco. Finalizar mesmo assim?")) return;
        }
        
        isLocked = true;
        clearInterval(timerInterval);
        let score = 0;

        currentQuestions.forEach((q, i) => {
            const correct = getCorrectAnswerIndex(q.id);
            const feedback = document.getElementById(`feedback-${i}`);
            feedback.classList.remove('hidden');

            document.getElementsByName(`q${i}`).forEach(inp => inp.disabled = true);

            if (userAnswers[i] === correct) {
                score += 5;
                feedback.innerHTML = "<span class='text-green-600'>‚úÖ Correto</span>";
                if(userAnswers[i] !== undefined) 
                    document.querySelector(`input[name="q${i}"][value="${userAnswers[i]}"]`).parentElement.classList.add('bg-green-100');
            } else {
                feedback.innerHTML = "<span class='text-red-600'>‚ùå Incorreto</span>";
                if(userAnswers[i] !== undefined)
                    document.querySelector(`input[name="q${i}"][value="${userAnswers[i]}"]`).parentElement.classList.add('bg-red-100');
            }
        });

        document.getElementById('score-display').textContent = score;
        document.getElementById('result-area').classList.remove('hidden');
        document.getElementById('btn-finish').classList.add('hidden');
        document.getElementById('btn-pdf').classList.remove('hidden');
        document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
    }

    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        const name = document.getElementById('studentName').value;
        const turma = document.getElementById('studentClass').value;
        const score = document.getElementById('score-display').textContent;
        const now = new Date();
        const authString = `${name}-${score}-${timeElapsed}-${penaltyCount}-${now.getTime()}`;

        let hash = 0;
        for (let i = 0; i < authString.length; i++) {
            hash = ((hash << 5) - hash) + authString.charCodeAt(i);
            hash |= 0;
        }
        const authCode = "AUTH-" + Math.abs(hash).toString(16).toUpperCase().padStart(8, '0');

        doc.setFillColor(37, 99, 235);
        doc.rect(0, 0, 210, 40, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(20);
        doc.text("Comprovante de Avalia√ß√£o", 105, 25, null, null, "center");
        
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(12);
        doc.text(`Aluno: ${name}`, 20, 60);
        doc.text(`Turma: ${turma}`, 20, 70);
        doc.text(`Data: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`, 20, 80);
        
        doc.setFontSize(14);
        doc.text(`Nota Final: ${score}/100`, 20, 100);
        doc.text(`Tempo: ${document.getElementById('timer-display').textContent}`, 120, 100);
        
        if(penaltyCount > 0) {
            doc.setTextColor(200, 0, 0);
            doc.text(`Penalidades: ${penaltyCount}`, 20, 115);
        } else {
            doc.setTextColor(0, 128, 0);
            doc.text("Conduta: Limpa (Sem penalidades)", 20, 115);
        }

        doc.setTextColor(100, 100, 100);
        doc.setFontSize(10);
        doc.text("C√≥digo de Autentica√ß√£o:", 105, 140, null, null, "center");
        doc.setFont("courier", "bold");
        doc.setFontSize(14);
        doc.text(authCode, 105, 150, null, null, "center");

        doc.save(`Relatorio_${name.replace(/\s+/g, '_')}.pdf`);
    }
</script>
</body>
</html>



