<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o de Recupera√ß√£o: UC Linguagem de Programa√ß√£o</title>
    <!-- Tailwind CSS (Estilo Visual) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF (Gerador de PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        
        /* --- CORRE√á√ÉO CR√çTICA: GARANTE QUE A TROCA DE TELA FUNCIONE SEM INTERNET --- */
        .hidden { display: none !important; }
        /* -------------------------------------------------------------------------- */

        /* Prote√ß√£o Anti-C√≥pia via CSS */
        .no-select {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }

        .question-card { transition: all 0.3s ease; }
        .question-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        /* Anima√ß√£o para o rel√≥gio quando estiver perto do fim */
        @keyframes pulse-red {
            0% { color: white; }
            50% { color: #ffcccc; }
            100% { color: white; }
        }
        .timer-warning {
            animation: pulse-red 1s infinite;
            font-weight: bold;
        }

        /* Anima√ß√£o para penalidade */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .penalty-shake {
            animation: shake 0.5s;
            background-color: #ef4444 !important; /* Red-500 */
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4 sm:px-6 lg:px-8 no-select" oncontextmenu="return false;">

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg relative overflow-hidden">
        
        <!-- ========================================== -->
        <!-- TELA 1: BOAS-VINDAS E REGRAS (VIS√çVEL INICIALMENTE) -->
        <!-- ========================================== -->
        <div id="welcome-screen" class="p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-blue-700">Avalia√ß√£o de Recupera√ß√£o - Linguagem de Programa√ß√£o</h1>
                <p class="text-gray-600 mt-2 text-lg">Situa√ß√£o de Aprendizagem 3</p>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
                <h2 class="text-lg font-bold text-blue-800 mb-2">üëã Ol√°, estudante!</h2>
                <p class="text-gray-700">
                    Voc√™ est√° prestes a iniciar sua avalia√ß√£o. Antes de come√ßar, leia atentamente as instru√ß√µes abaixo.
                    <br><strong>Dica:</strong> Se voc√™ n√£o se sentir preparado(a), utilize os links de revis√£o abaixo e retorne a esta p√°gina em outro momento.
                </p>
            </div>

            <!-- Dados do Aluno (Preenchimento Obrigat√≥rio ANTES de come√ßar) -->
            <div class="mb-8 bg-gray-50 p-6 rounded-lg border border-gray-200">
                <h3 class="text-md font-bold text-gray-700 mb-4 uppercase tracking-wide border-b pb-2">1. Identifica√ß√£o</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="studentName" class="block text-sm font-medium text-gray-700">Nome Completo</label>
                        <input type="text" id="studentName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3 border select-text" placeholder="Digite seu nome...">
                    </div>
                    <div>
                        <label for="studentClass" class="block text-sm font-medium text-gray-700">Turma</label>
                        <input type="text" id="studentClass" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3 border select-text" placeholder="Ex: 1¬∫ Mecatr√¥nica">
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Conte√∫do Cobrado -->
                <div class="bg-white border border-gray-200 p-5 rounded-lg shadow-sm">
                    <h3 class="text-md font-bold text-gray-800 mb-3 flex items-center">
                        üìö O que vai cair na prova?
                    </h3>
                    <ul class="text-sm text-gray-600 space-y-2 list-disc pl-4">
                        <li><strong>Arduino B√°sico:</strong> <code>setup()</code>, <code>loop()</code>, vari√°veis, condicionais (if/else).</li>
                        <li><strong>Sensores:</strong> Ultrass√¥nico (HC-SR04), Temperatura/Umidade (DHT11), Luz (LDR).</li>
                        <li><strong>Atuadores:</strong> Rel√©s, LEDs comuns e RGB.</li>
                        <li><strong>Interfaces:</strong> Teclado Matricial, Display LCD 16x2.</li>
                        <li><strong>L√≥gica:</strong> Controle de acesso, monitoramento ambiental e ilumina√ß√£o inteligente.</li>
                    </ul>
                </div>

                <!-- Regras de Seguran√ßa -->
                <div class="bg-yellow-50 border border-yellow-200 p-5 rounded-lg shadow-sm">
                    <h3 class="text-md font-bold text-red-700 mb-3 flex items-center">
                        ‚ö†Ô∏è Regras Anti-Fraude
                    </h3>
                    <ul class="text-sm text-gray-700 space-y-2">
                        <li class="flex items-start gap-2"><span class="text-red-500">‚úñ</span> <strong>N√£o saia da aba:</strong> O sistema detecta se voc√™ mudar de janela.</li>
                        <li class="flex items-start gap-2"><span class="text-red-500">‚úñ</span> <strong>N√£o copie:</strong> Copiar textos gera penalidade imediata.</li>
                        <li class="flex items-start gap-2"><span class="text-red-500">‚è≥</span> <strong>Tempo Limite:</strong> Voc√™ ter√° <strong>30 minutos</strong> corridos.</li>
                        <li class="mt-2 text-xs font-bold text-red-800 bg-red-100 p-2 rounded block text-center">
                            10 Penalidades = PROVA BLOQUEADA
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Material de Estudo Extra -->
            <div class="mb-8 bg-white border border-gray-200 p-6 rounded-lg shadow-sm">
                <h3 class="text-md font-bold text-blue-800 mb-4 flex items-center gap-2">
                    üéì Material de Estudo (Revis√£o)
                </h3>
                <p class="text-sm text-gray-600 mb-4">Acesse os links oficiais das esta√ß√µes para revisar o conte√∫do antes de iniciar:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                    <div>
                        <h4 class="font-bold text-gray-700 mb-2 border-b pb-1">Programa√ß√£o e L√≥gica</h4>
                        <ul class="list-disc pl-4 space-y-1 text-blue-600">
                            <li><a href="https://youtu.be/ZaGx0ll0pnU" target="_blank" class="hover:underline hover:text-blue-800 transition">Estruturas Condicionais (If/Else)</a></li>
                            <li><a href="https://youtu.be/MeAA0oX6LyE" target="_blank" class="hover:underline hover:text-blue-800 transition">Entradas Digitais (Bot√µes)</a></li>
                            <li><a href="https://youtu.be/hRtF2UCNatM" target="_blank" class="hover:underline hover:text-blue-800 transition">Sa√≠das Digitais (LEDs/Rel√©s)</a></li>
                            <li><a href="https://youtu.be/5jIXvmFP89U" target="_blank" class="hover:underline hover:text-blue-800 transition">Entradas Anal√≥gicas</a></li>
                            <li><a href="https://docs.arduino.cc/software/ide-v2/tutorials/ide-v2-serial-monitor/" target="_blank" class="hover:underline hover:text-blue-800 transition">Monitor Serial</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-700 mb-2 border-b pb-1">Componentes e Sensores</h4>
                        <ul class="list-disc pl-4 space-y-1 text-blue-600">
                            <li><a href="https://youtu.be/MQlRQaOtkoM" target="_blank" class="hover:underline hover:text-blue-800 transition">Teclado de Membrana 4x4</a></li>
                            <li><a href="https://youtu.be/0yxg3Z_Gc60" target="_blank" class="hover:underline hover:text-blue-800 transition">Display LCD 16x2</a></li>
                            <li><a href="https://projecthub.arduino.cc/Isaac100/getting-started-with-the-hc-sr04-ultrasonic-sensor-7cabe1" target="_blank" class="hover:underline hover:text-blue-800 transition">Sensor Ultrass√¥nico (HC-SR04)</a></li>
                            <li><a href="https://projecthub.arduino.cc/arcaegecengiz/using-dht11-12f621" target="_blank" class="hover:underline hover:text-blue-800 transition">Sensor Temp/Umid (DHT11)</a></li>
                            <li><a href="https://projecthub.arduino.cc/mediumturkey115/ldr-sensor-with-arduino-e6cd15" target="_blank" class="hover:underline hover:text-blue-800 transition">Sensor de Luz (LDR)</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <button onclick="startExam()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg transform transition hover:scale-[1.01] duration-200 text-lg flex justify-center items-center gap-2">
                üöÄ Estou pronto! INICIAR AVALIA√á√ÉO
            </button>
            <p class="text-xs text-gray-400 text-center mt-2">Ao clicar, o tempo come√ßar√° a contar e as prote√ß√µes ser√£o ativadas.</p>
        </div>


        <!-- ========================================== -->
        <!-- TELA 2: AVALIA√á√ÉO (INICIALMENTE OCULTA) -->
        <!-- ========================================== -->
        <div id="exam-screen" class="hidden relative">
            
            <!-- Cabe√ßalho Flutuante -->
            <div class="bg-blue-600 px-6 py-4 text-white flex flex-col md:flex-row justify-between items-center sticky top-0 z-50 shadow-md gap-4">
                <div>
                    <h1 class="text-lg md:text-xl font-bold">Avalia√ß√£o em Andamento</h1>
                    <p class="text-blue-100 text-xs mt-1" id="student-display">Aluno: ...</p>
                </div>
                
                <div class="flex gap-4">
                    <!-- Mostrador de Penalidades -->
                    <div id="penalty-box" class="bg-red-800 px-3 py-2 rounded-lg text-center shadow-inner transition-colors duration-300 min-w-[100px]">
                        <p class="text-[10px] text-red-200 uppercase tracking-wide">Penalidades</p>
                        <div class="text-lg font-mono font-bold"><span id="penalty-display">0</span>/10</div>
                    </div>

                    <!-- Timer -->
                    <div class="bg-blue-800 px-3 py-2 rounded-lg text-center shadow-inner min-w-[100px]">
                        <p class="text-[10px] text-blue-200 uppercase tracking-wide">Tempo</p>
                        <div id="timer-display" class="text-lg font-mono font-bold">00:00</div>
                    </div>
                </div>
            </div>

            <!-- √Årea do Quiz -->
            <div id="quiz-container" class="p-6 space-y-6 bg-gray-50 min-h-[500px]">
                <!-- As quest√µes ser√£o inseridas aqui via JavaScript -->
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="p-6 bg-white border-t border-gray-200 flex justify-end items-center gap-4">
                <button onclick="finishQuiz()" id="btn-finish" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow transition duration-200">
                    Finalizar e Ver Nota
                </button>
                <button onclick="generatePDF()" id="btn-pdf" class="hidden bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg shadow transition duration-200 flex items-center gap-2">
                    üìÑ Baixar Comprovante (PDF)
                </button>
            </div>
            
            <!-- Resultado -->
            <div id="result-area" class="hidden p-6 bg-yellow-50 text-center border-t border-yellow-200">
                <h3 class="text-2xl font-bold text-gray-800">Sua Nota: <span id="score-display" class="text-blue-600"></span>/100</h3>
                <p class="text-gray-600 mt-2">Clique no bot√£o "Baixar Comprovante" para salvar seu recibo de nota e enviar ao professor.</p>
            </div>
        </div>
    </div>

<script>
    // --- ESTADO DO SISTEMA ---
    let isExamStarted = false;
    let isLocked = false;
    
    // --- SISTEMA ANTI-FRAUDE ---
    let penaltyCount = 0;
    const MAX_PENALTIES = 10;

    function addPenalty(reason) {
        // S√≥ aplica penalidade se a prova j√° come√ßou e n√£o est√° travada/finalizada
        if (!isExamStarted || isLocked) return;

        // Se o bot√£o de finalizar estiver oculto (prova j√° corrigida), n√£o gera penalidade
        if (document.getElementById('btn-finish').classList.contains('hidden')) return;

        penaltyCount++;
        const display = document.getElementById('penalty-display');
        const box = document.getElementById('penalty-box');
        
        display.textContent = penaltyCount;
        
        // Efeito visual de alerta
        box.classList.add('penalty-shake');
        setTimeout(() => box.classList.remove('penalty-shake'), 500);

        setTimeout(() => {
            alert(`‚ö†Ô∏è ATEN√á√ÉO: PENALIDADE REGISTRADA!\n\nMotivo: ${reason}\n\nVoc√™ tem ${penaltyCount}/${MAX_PENALTIES} penalidades. Ao atingir 10, a prova ser√° bloqueada.`);
        }, 100);

        if (penaltyCount >= MAX_PENALTIES) {
            lockQuiz("Limite de penalidades atingido por comportamento suspeito.");
        }
    }

    // 1. Monitoramento de Sa√≠da de Aba
    document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
            addPenalty("Sa√≠da da aba/janela ou minimiza√ß√£o do navegador.");
        }
    });

    // 2. Monitoramento de C√≥pia e Sele√ß√£o
    document.addEventListener('copy', (e) => {
        if (!isExamStarted) return; // Permite copiar na tela de boas-vindas
        e.preventDefault();
        addPenalty("Tentativa de copiar conte√∫do.");
    });
    
    document.addEventListener('cut', (e) => {
        if (!isExamStarted) return;
        e.preventDefault();
        addPenalty("Tentativa de recortar conte√∫do.");
    });

    // Desabilitar menu de contexto (bot√£o direito)
    document.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        return false;
    });

    // --- CONTROLE DE FLUXO ---
    function startExam() {
        try {
            const nameInput = document.getElementById('studentName');
            const turmaInput = document.getElementById('studentClass');
            
            if(!nameInput || !turmaInput) {
                alert("Erro interno: Campos de formul√°rio n√£o encontrados.");
                return;
            }

            const name = nameInput.value.trim();
            const turma = turmaInput.value.trim();

            if (!name || !turma) {
                alert("Por favor, preencha seu Nome e Turma para iniciar.");
                return;
            }

            if(!confirm("Tem certeza que deseja iniciar? O tempo come√ßar√° a contar e as penalidades por sa√≠da de tela estar√£o ativas.")) return;

            // Transi√ß√£o de Tela
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('exam-screen').classList.remove('hidden');
            
            // Atualiza display do aluno no cabe√ßalho da prova
            document.getElementById('student-display').textContent = `Aluno: ${name} (${turma})`;

            // Inicia L√≥gicas
            isExamStarted = true;
            generateQuiz();
            startTimer();
            
            // Rola para o topo para garantir visualiza√ß√£o do cabe√ßalho sticky
            window.scrollTo(0, 0);
        } catch (error) {
            alert("Erro ao iniciar a prova: " + error.message);
            console.error(error);
        }
    }

    // --- L√ìGICA DO REL√ìGIO ---
    let timeElapsed = 0;
    const timeLimit = 30 * 60; // 30 minutos em segundos
    let timerInterval;

    function startTimer() {
        const timerDisplay = document.getElementById('timer-display');
        
        timerInterval = setInterval(() => {
            if (isLocked) {
                clearInterval(timerInterval);
                return;
            }

            timeElapsed++;
            
            const minutes = Math.floor(timeElapsed / 60);
            const seconds = timeElapsed % 60;
            const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timerDisplay.textContent = formattedTime;
            
            if (timeElapsed >= (29 * 60)) {
                timerDisplay.classList.add('timer-warning');
            }

            if (timeElapsed >= timeLimit) {
                lockQuiz("Tempo de prova esgotado (30 minutos).");
                timerDisplay.textContent = "30:00 (FIM)";
            }
        }, 1000);
    }

    function lockQuiz(reason) {
        if (isLocked) return;
        isLocked = true;
        clearInterval(timerInterval);

        const inputs = document.querySelectorAll('input[type="radio"]');
        inputs.forEach(input => input.disabled = true);
        
        alert(`üö´ PROVA BLOQUEADA!\n\nMotivo: ${reason}\n\nO formul√°rio foi bloqueado para novas respostas. Finalize para gerar o relat√≥rio.`);
    }

    // --- BANCO DE DADOS DE QUEST√ïES ---
    const questionBank = [
        // --- C++ B√°sico e Estrutura Arduino (20 quest√µes) ---
        { q: "Qual fun√ß√£o do Arduino roda apenas uma vez quando a placa √© ligada?", options: ["loop()", "setup()", "main()", "start()"], a: 1 },
        { q: "Qual fun√ß√£o do Arduino √© executada repetidamente em ciclo infinito?", options: ["setup()", "repeat()", "loop()", "cycle()"], a: 2 },
        { q: "Para configurar um pino como sa√≠da de energia, qual comando utilizamos?", options: ["pinMode(pino, OUTPUT)", "pinMode(pino, INPUT)", "digitalWrite(pino, HIGH)", "analogWrite(pino, 255)"], a: 0 },
        { q: "Qual comando √© usado para ler o estado de um bot√£o digital?", options: ["analogRead()", "digitalWrite()", "digitalRead()", "pinMode()"], a: 2 },
        { q: "O que o comando 'delay(2000)' faz no c√≥digo?", options: ["Pausa o programa por 2000 segundos", "Pausa o programa por 2 segundos", "Reinicia o Arduino", "Espera um bot√£o ser pressionado"], a: 1 },
        { q: "Em C++, como declaramos uma vari√°vel para armazenar n√∫meros inteiros?", options: ["float", "String", "boolean", "int"], a: 3 },
        { q: "Qual o tipo de vari√°vel mais adequado para armazenar a temperatura '25.5'?", options: ["int", "char", "float", "long"], a: 2 },
        { q: "O que significa o s√≠mbolo '//' no c√≥digo do Arduino?", options: ["In√≠cio de fun√ß√£o", "Divis√£o", "Coment√°rio de uma linha", "Fim de instru√ß√£o"], a: 2 },
        { q: "Qual operador √© usado para verificar igualdade em uma condi√ß√£o 'if'?", options: ["=", "==", "===", "!="], a: 1 },
        { q: "Qual operador l√≥gico representa 'E' (AND)?", options: ["||", "!", "&&", "**"], a: 2 },
        { q: "Qual operador l√≥gico representa 'OU' (OR)?", options: ["&&", "||", "??", "!"], a: 1 },
        { q: "O s√≠mbolo '!' antes de uma vari√°vel booleana serve para:", options: ["Confirmar o valor", "Inverter o valor (N√ÉO l√≥gico)", "Transformar em inteiro", "Apagar a vari√°vel"], a: 1 },
        { q: "Qual biblioteca √© essencial para usar o Display LCD 16x2?", options: ["&lt;Keypad.h&gt;", "&lt;DHT.h&gt;", "&lt;LiquidCrystal.h&gt;", "&lt;Servo.h&gt;"], a: 2 },
        { q: "Para incluir uma biblioteca no c√≥digo, usamos a diretiva:", options: ["#define", "#include", "import", "using"], a: 1 },
        { q: "O comando 'Serial.begin(9600)' serve para:", options: ["Ligar o LCD", "Iniciar a comunica√ß√£o com o computador", "Definir a velocidade do motor", "Configurar um pino PWM"], a: 1 },
        { q: "Qual pontua√ß√£o √© usada para finalizar uma instru√ß√£o em C++?", options: [":", ".", ";", ","], a: 2 },
        { q: "O que acontece se esquecermos de fechar uma chave '}' no c√≥digo?", options: ["O c√≥digo roda normalmente", "Erro de compila√ß√£o", "O Arduino trava", "Apenas a √∫ltima fun√ß√£o falha"], a: 1 },
        { q: "A fun√ß√£o 'lcd.clear()' serve para:", options: ["Desligar o LCD", "Acender a luz de fundo", "Limpar todos os caracteres da tela", "Reiniciar o Arduino"], a: 2 },
        { q: "O que a fun√ß√£o 'lcd.setCursor(0, 1)' faz?", options: ["Vai para a coluna 0, linha 0", "Vai para a coluna 0, linha 1 (segunda linha)", "Escreve '0' e '1' na tela", "Limpa a linha 1"], a: 1 },
        { q: "Para concatenar (juntar) texto em uma String, usamos o operador:", options: ["*", "-", "+", "%"], a: 2 },
        // --- Esta√ß√£o 1 & 4: Teclado e Senha (15 quest√µes) ---
        { q: "No projeto da Catraca, qual componente √© usado para entrada de senha?", options: ["LDR", "Sensor Ultrass√¥nico", "Teclado Matricial 4x4", "Potenci√¥metro"], a: 2 },
        { q: "Qual biblioteca facilita o uso do teclado matricial?", options: ["Matrix.h", "Keypad.h", "Button.h", "Input.h"], a: 1 },
        { q: "Se a senha correta √© '1234' e o usu√°rio digita '1234', qual fun√ß√£o compara as Strings?", options: ["texto.compare()", "texto.check()", "texto.equals()", "texto.is()"], a: 2 },
        { q: "No c√≥digo da Catraca, a tecla '#' foi programada para:", options: ["Apagar a senha", "Digitar o n√∫mero zero", "Confirmar (Enter)", "Reiniciar o sistema"], a: 2 },
        { q: "No c√≥digo da Catraca, a tecla '*' foi usada para:", options: ["Confirmar", "Cancelar/Limpar", "Ligar o LED", "Digitar uma letra"], a: 1 },
        { q: "O que √© um 'LCD Keypad Shield'?", options: ["Um escudo de prote√ß√£o f√≠sica", "Uma placa que acopla LCD e bot√µes no Arduino", "Um tipo de sensor de temperatura", "Um software de simula√ß√£o"], a: 1 },
        { q: "Para exibir um asterisco '*' ao inv√©s do n√∫mero digitado na senha, usamos:", options: ["lcd.print('*')", "lcd.noDisplay()", "lcd.hide()", "Serial.print('*')"], a: 0 },
        { q: "Qual vari√°vel foi usada para armazenar a senha digitada?", options: ["int", "float", "String", "char"], a: 2 },
        { q: "No projeto da Trava Eletromagn√©tica, o sistema √© 'biest√°vel'. O que isso significa?", options: ["Tem dois microcontroladores", "Alterna entre dois estados est√°veis (Travado/Destravado)", "Funciona com duas baterias", "S√≥ funciona por 2 segundos"], a: 1 },
        { q: "O operador tern√°rio 'condi√ß√£o ? valor1 : valor2' substitui qual estrutura?", options: ["for", "while", "if...else simples", "switch...case"], a: 2 },
        { q: "Se 'trava_destravada' √© false, o que '!trava_destravada' retorna?", options: ["false", "true", "null", "erro"], a: 1 },
        { q: "Para limpar a vari√°vel 'senha_digitada', atribu√≠mos a ela:", options: ["0", "null", "\"\" (string vazia)", "false"], a: 2 },
        { q: "Quantos pinos digitais s√£o necess√°rios para controlar as linhas de um teclado 4x4?", options: ["2", "4", "8", "16"], a: 1 },
        { q: "O mapeamento das teclas do teclado matricial √© feito usando:", options: ["Um array bidimensional (matriz)", "Uma lista simples", "Uma vari√°vel int", "Um sensor anal√≥gico"], a: 0 },
        { q: "No projeto da Trava, o Rel√© em estado HIGH significa:", options: ["Trava Aberta", "Trava Fechada (Desligado)", "Curto-circuito", "LED queimado"], a: 1 },
        // --- Esta√ß√£o 2: Ultrass√¥nico e Alarme (12 quest√µes) ---
        { q: "Qual sensor foi utilizado para o Alarme de Intrus√£o?", options: ["DHT11", "LDR", "HC-SR04 (Ultrass√¥nico)", "LM35"], a: 2 },
        { q: "O pino 'Trig' do sensor ultrass√¥nico serve para:", options: ["Receber o eco", "Enviar o pulso sonoro", "Alimentar o sensor", "Aterrar o sensor"], a: 1 },
        { q: "O pino 'Echo' do sensor ultrass√¥nico serve para:", options: ["Enviar o som", "Receber o pulso refletido", "Configurar a dist√¢ncia", "Ligar o LED"], a: 1 },
        { q: "A velocidade do som usada no c√°lculo da dist√¢ncia √© aproximadamente:", options: ["340 m/s", "100 km/h", "300.000 km/s", "10 m/s"], a: 0 },
        { q: "Por que dividimos o tempo de viagem do som por 2 no c√°lculo da dist√¢ncia?", options: ["Para converter metros em cent√≠metros", "Porque o som vai e volta", "Para reduzir o ru√≠do", "√â uma constante do Arduino"], a: 1 },
        { q: "Qual fun√ß√£o mede a dura√ß√£o do pulso no pino Echo?", options: ["digitalRead()", "analogRead()", "pulseIn()", "time()"], a: 2 },
        { q: "A fun√ß√£o 'delayMicroseconds(10)' √© usada para:", options: ["Pausar por 10 segundos", "Gerar o pulso de disparo no Trig", "Esperar o LCD ligar", "Reiniciar o sensor"], a: 1 },
        { q: "No alarme, se a dist√¢ncia for menor que o limite, o que acontece?", options: ["O sistema desliga", "O LED acende e o Rel√© ativa", "O Arduino reinicia", "O sensor para de ler"], a: 1 },
        { q: "O sensor ultrass√¥nico usa ondas sonoras de:", options: ["Baixa frequ√™ncia (graves)", "Alta frequ√™ncia (inaud√≠veis)", "Luz infravermelha", "R√°dio frequ√™ncia"], a: 1 },
        { q: "O M√≥dulo de Rel√© √© usado no projeto para:", options: ["Medir a dist√¢ncia", "Simular uma sirene ou l√¢mpada de alta pot√™ncia", "Armazenar dados", "Substituir o Arduino"], a: 1 },
        { q: "O que acontece com o rel√© quando enviamos um sinal LOW (em m√≥dulos ativo-baixo)?", options: ["Ele desliga", "Ele liga (ativa)", "Ele queima", "Nada acontece"], a: 1 },
        { q: "A vari√°vel 'long' √© usada para armazenar a dura√ß√£o do pulso porque:", options: ["√â um n√∫mero decimal", "√â um texto", "Pode ser um n√∫mero inteiro muito grande", "√â negativo"], a: 2 },
        // --- Esta√ß√£o 3: LED RGB e Status (10 quest√µes) ---
        { q: "Um LED RGB pode emitir:", options: ["Apenas luz vermelha", "Apenas luz branca", "V√°rias cores combinando Vermelho, Verde e Azul", "Som"], a: 2 },
        { q: "Para controlar a intensidade das cores do LED RGB, usamos qual fun√ß√£o?", options: ["digitalWrite()", "analogWrite() (PWM)", "digitalRead()", "tone()"], a: 1 },
        { q: "Pinos PWM no Arduino s√£o identificados por:", options: ["Uma letra 'A'", "Um s√≠mbolo '~' ou a sigla PWM", "A cor vermelha", "N√£o t√™m identifica√ß√£o"], a: 1 },
        { q: "A cor Amarela no LED RGB √© formada misturando:", options: ["Vermelho e Azul", "Verde e Azul", "Vermelho e Verde", "Apenas Verde"], a: 2 },
        { q: "O que significa 'Debounce' no contexto de bot√µes?", options: ["Fazer o bot√£o pular", "T√©cnica para evitar leituras falsas/ru√≠do ao pressionar", "Ligar o bot√£o no 5V", "Queimar o bot√£o"], a: 1 },
        { q: "O modo INPUT_PULLUP configura o bot√£o para:", options: ["Ler HIGH quando pressionado", "Ler LOW quando pressionado e usar resistor interno", "Precisar de um resistor externo", "Funcionar como sa√≠da"], a: 1 },
        { q: "A estrutura 'enum' foi usada no c√≥digo para:", options: ["Contar n√∫meros", "Definir estados nomeados (LIVRE, OCUPADO, ATENCAO)", "Criar um loop", "Configurar o LCD"], a: 1 },
        { q: "Os valores de PWM variam de:", options: ["0 a 1023", "0 a 100", "0 a 255", "-128 a 127"], a: 2 },
        { q: "Se usarmos 'analogWrite(pino, 0)', o LED:", options: ["Brilha ao m√°ximo", "Pisca", "Apaga", "Muda de cor"], a: 2 },
        { q: "Qual a vantagem de usar fun√ß√µes (como statusLivre()) no c√≥digo?", options: ["Deixa o c√≥digo mais lento", "Organiza e facilita a leitura do c√≥digo", "Gasta mais mem√≥ria", "N√£o tem vantagem"], a: 1 },
        // --- Esta√ß√£o 5 & 6: DHT11, Temperatura e Umidade (13 quest√µes) ---
        { q: "O sensor DHT11 mede quais grandezas?", options: ["Luz e Som", "Temperatura e Umidade", "Dist√¢ncia e Presen√ßa", "Press√£o e Altitude"], a: 1 },
        { q: "Qual o intervalo m√≠nimo recomendado entre leituras do DHT11?", options: ["10 milissegundos", "500 milissegundos", "2 segundos", "1 minuto"], a: 2 },
        { q: "A fun√ß√£o 'isnan()' verifica:", options: ["Se o valor √© um n√∫mero v√°lido", "Se o valor √© zero", "Se o sensor est√° desligado", "Se √© um n√∫mero inteiro"], a: 0 },
        { q: "No monitor de temperatura, os valores s√£o exibidos em qual unidade?", options: ["Fahrenheit", "Kelvin", "Celsius", "Volts"], a: 2 },
        { q: "Para exibir uma vari√°vel float com apenas 1 casa decimal no LCD, usamos:", options: ["lcd.print(var, 1)", "lcd.print(var, 0)", "lcd.decimal(var)", "lcd.one(var)"], a: 0 },
        { q: "Se a umidade ultrapassar o limite cr√≠tico, o sistema:", options: ["Desliga o Arduino", "Aciona um Rel√© (Exaustor)", "Apaga o LCD", "Toca m√∫sica"], a: 1 },
        { q: "Para ler a temperatura do DHT11, usamos o comando:", options: ["dht.read()", "dht.getTemp()", "dht.readTemperature()", "analogRead()"], a: 2 },
        { q: "O que √© 'Histerese' no controle de umidade?", options: ["Um erro do sensor", "Uma faixa de diferen√ßa entre ligar e desligar para evitar oscila√ß√£o", "Um tipo de cabo", "A velocidade do cooler"], a: 1 },
        { q: "No projeto, o pino de dados do DHT11 foi ligado no pino digital:", options: ["0", "1", "40", "A0"], a: 2 },
        { q: "Se o sensor DHT11 falhar, o c√≥digo foi programado para:", options: ["Travar", "Exibir 'Erro de Sensor' no LCD", "Reiniciar sozinho", "Ignorar o erro"], a: 1 },
        { q: "A biblioteca DHT.h serve para:", options: ["Controlar motores", "Facilitar a comunica√ß√£o com sensores DHT", "Ler teclados", "Gerar sons"], a: 1 },
        { q: "Umidade Cr√≠tica foi definida no c√≥digo como:", options: ["Uma constante float", "Uma vari√°vel int", "Uma String", "Um pino"], a: 0 },
        { q: "O que o comando 'dht.begin()' faz?", options: ["L√™ a temperatura", "Inicializa o sensor", "Para o sensor", "Calibra o sensor"], a: 1 },
        // --- Esta√ß√£o 7 & 8: LDR e Ilumina√ß√£o (15 quest√µes) ---
        { q: "O componente LDR √© um tipo de:", options: ["LED", "Capacitor", "Resistor que varia com a luz", "Transistor"], a: 2 },
        { q: "Quando a luz incide sobre o LDR, sua resist√™ncia:", options: ["Aumenta", "Diminui", "Permanece igual", "Queima"], a: 1 },
        { q: "O LDR deve ser conectado a qual tipo de pino no Arduino para medir intensidade?", options: ["Digital", "PWM", "Anal√≥gico (Ex: A8)", "Alimenta√ß√£o apenas"], a: 2 },
        { q: "A fun√ß√£o 'analogRead()' retorna um valor entre:", options: ["0 e 255", "0 e 1023", "0 e 1", "-5V e +5V"], a: 1 },
        { q: "Para converter o valor bruto do LDR (0-1023) para porcentagem (0-100), usamos:", options: ["convert()", "map()", "pulseIn()", "transform()"], a: 1 },
        { q: "A fun√ß√£o 'constrain(valor, 0, 100)' serve para:", options: ["For√ßar o valor a ficar entre 0 e 100", "Zerar o valor", "Multiplicar por 100", "Dividir por 100"], a: 0 },
        { q: "No projeto de Ilumina√ß√£o Autom√°tica, o que acontece se o ambiente escurecer?", options: ["Os rel√©s desligam", "Os rel√©s ligam gradativamente", "O LCD apaga", "O LDR para de ler"], a: 1 },
        { q: "Para controlar 4 rel√©s, foi utilizado no c√≥digo:", options: ["4 vari√°veis soltas", "Um array (vetor) de pinos e um loop for", "4 Arduinos", "Uma matriz de LEDs"], a: 1 },
        { q: "O que √© um 'Divisor de Tens√£o' usado com o LDR?", options: ["Uma ferramenta de corte", "Um circuito com 2 resistores para dividir a voltagem", "Um software", "Uma bateria extra"], a: 1 },
        { q: "Se a leitura do LDR for muito inst√°vel, qual t√©cnica foi sugerida nos desafios?", options: ["M√©dia M√≥vel", "Trocar o Arduino", "Usar cola quente", "Aumentar a voltagem"], a: 0 },
        { q: "No c√≥digo, 'map(valor, MIN, MAX, 0, 100)' faz o qu√™?", options: ["Desenha um mapa", "Escala o valor de uma faixa para outra", "Procura um valor", "Apaga a mem√≥ria"], a: 1 },
        { q: "O 'Feedback visual' no projeto de ilumina√ß√£o foi feito com:", options: ["Um motor", "Uma sirene", "Um LED piscando ou Display LCD", "Aquecimento"], a: 2 },
        { q: "Os limites de luminosidade para acionar os rel√©s foram definidos como:", options: ["Constantes percentuais", "Valores aleat√≥rios", "Strings", "Fun√ß√µes"], a: 0 },
        { q: "Para inverter o estado de um pino digital (Toggle) usamos:", options: ["digitalWrite(pino, !digitalRead(pino))", "digitalWrite(pino, 0)", "analogWrite(pino, 255)", "pinMode(pino, OUTPUT)"], a: 0 },
        { q: "Em um ambiente totalmente escuro, o valor lido pelo pino anal√≥gico do LDR tende a ser:", options: ["Pr√≥ximo do extremo (dependendo da montagem)", "Sempre zero", "Aleat√≥rio", "Sempre 512"], a: 0 },
        // --- Conceitos Gerais e Eletr√¥nica (15 quest√µes) ---
        { q: "O que √© um Rel√©?", options: ["Um sensor de luz", "Um interruptor eletromec√¢nico controlado eletricamente", "Um gerador de energia", "Um tipo de mem√≥ria"], a: 1 },
        { q: "Por que usamos resistores em s√©rie com LEDs?", options: ["Para aumentar o brilho", "Para limitar a corrente e n√£o queimar o LED", "Para mudar a cor", "Para inverter a polaridade"], a: 1 },
        { q: "O Arduino Mega, usado nos projetos, √© programado em qual linguagem base?", options: ["Python", "Java", "C++", "HTML"], a: 2 },
        { q: "O que significa GND?", options: ["Grande", "Ground (Terra/Negativo)", "Ganho", "Geral"], a: 1 },
        { q: "O que √© VCC ou 5V?", options: ["O pino de dados", "A alimenta√ß√£o positiva", "O terra", "A entrada anal√≥gica"], a: 1 },
        { q: "Qual a fun√ß√£o do 'Serial Monitor' na IDE do Arduino?", options: ["Ver v√≠deos", "Exibir dados enviados pelo Arduino para o PC", "Desenhar gr√°ficos 3D", "Compilar o c√≥digo"], a: 1 },
        { q: "Uma vari√°vel 'const int' pode ter seu valor alterado durante o loop?", options: ["Sim", "N√£o, √© uma constante", "√Äs vezes", "Apenas se reiniciar"], a: 1 },
        { q: "Qual a diferen√ßa entre Digital e Anal√≥gico?", options: ["Digital tem 2 estados (0/1), Anal√≥gico tem valores cont√≠nuos", "N√£o h√° diferen√ßa", "Anal√≥gico √© melhor", "Digital √© para √°udio apenas"], a: 0 },
        { q: "O que √© um 'Protoboard'?", options: ["Uma placa de circuito impresso final", "Uma placa de ensaio para montagem sem solda", "O processador do Arduino", "Uma bateria"], a: 1 },
        { q: "Para que serve o bot√£o 'Reset' no Arduino?", options: ["Apagar o c√≥digo", "Reiniciar a execu√ß√£o do programa do in√≠cio", "Desligar a placa", "Salvar o c√≥digo"], a: 1 },
        { q: "O comando 'Serial.println()' difere do 'Serial.print()' porque:", options: ["Imprime colorido", "Pula uma linha ao final", "Imprime mais r√°pido", "Imprime apenas n√∫meros"], a: 1 },
        { q: "Qual a resolu√ß√£o padr√£o do conversor anal√≥gico-digital (ADC) do Arduino Mega/Uno?", options: ["8 bits (0-255)", "10 bits (0-1023)", "12 bits (0-4095)", "16 bits"], a: 1 },
        { q: "O sensor DHT11 √© digital ou anal√≥gico?", options: ["Anal√≥gico", "Digital (envia dados codificados)", "Mec√¢nico", "Nenhum"], a: 1 },
        { q: "O que acontece se ligarmos um LED invertido?", options: ["Ele pisca", "Ele n√£o acende", "Ele explode", "Ele muda de cor"], a: 1 },
        { q: "Na metodologia de Rota√ß√£o por Esta√ß√µes, o objetivo √©:", options: ["Ficar parado", "Passar por diferentes pontos de aprendizagem realizando tarefas variadas", "Apenas copiar o c√≥digo", "Competir com os colegas"], a: 1 }
    ];

    let currentQuestions = [];
    let userAnswers = {};

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function generateQuiz() {
        const container = document.getElementById('quiz-container');
        container.innerHTML = '';
        userAnswers = {};

        const shuffledBank = shuffleArray([...questionBank]);
        currentQuestions = shuffledBank.slice(0, 20);

        currentQuestions.forEach((qObj, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-card bg-white p-6 rounded-lg border border-gray-200 shadow-sm';
            
            let optionsHTML = '';
            qObj.options.forEach((opt, i) => {
                optionsHTML += `
                    <label class="flex items-center space-x-3 p-3 rounded hover:bg-blue-50 cursor-pointer transition">
                        <input type="radio" name="q${index}" value="${i}" class="form-radio h-5 w-5 text-blue-600" onchange="saveAnswer(${index}, ${i})">
                        <span class="text-gray-700">${opt}</span>
                    </label>
                `;
            });

            questionDiv.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 mb-3">${index + 1}. ${qObj.q}</h3>
                <div class="space-y-2">
                    ${optionsHTML}
                </div>
                <div id="feedback-${index}" class="mt-3 text-sm font-semibold hidden"></div>
            `;
            container.appendChild(questionDiv);
        });
    }

    function saveAnswer(questionIndex, optionIndex) {
        userAnswers[questionIndex] = optionIndex;
    }

    function finishQuiz() {
        if (!isLocked && Object.keys(userAnswers).length < 20) {
            if(!confirm("Voc√™ n√£o respondeu todas as quest√µes. Deseja finalizar mesmo assim?")) return;
        }
        
        clearInterval(timerInterval);
        isLocked = true;

        let score = 0;
        let scoreDisplay = document.getElementById('score-display');
        
        currentQuestions.forEach((q, index) => {
            const feedbackDiv = document.getElementById(`feedback-${index}`);
            feedbackDiv.classList.remove('hidden');
            
            const selected = userAnswers[index];
            const inputs = document.getElementsByName(`q${index}`);
            
            inputs.forEach(input => input.disabled = true);

            if (selected === q.a) {
                score += 5;
                feedbackDiv.textContent = "‚úÖ Correto!";
                feedbackDiv.className = "mt-3 text-sm font-semibold text-green-600";
                if (selected !== undefined) inputs[selected].parentElement.classList.add('bg-green-100', 'border', 'border-green-300');
            } else {
                feedbackDiv.textContent = `‚ùå Incorreto.`; 
                feedbackDiv.className = "mt-3 text-sm font-semibold text-red-600";
                if (selected !== undefined) inputs[selected].parentElement.classList.add('bg-red-100', 'border', 'border-red-300');
            }
        });

        scoreDisplay.textContent = score;
        document.getElementById('result-area').classList.remove('hidden');
        document.getElementById('btn-finish').classList.add('hidden');
        document.getElementById('btn-pdf').classList.remove('hidden');
        
        document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
    }

    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        const name = document.getElementById('studentName').value;
        const turma = document.getElementById('studentClass').value;
        const score = document.getElementById('score-display').textContent;
        
        const now = new Date();
        const date = now.toLocaleDateString('pt-BR');
        const time = now.toLocaleTimeString('pt-BR');

        const dadosProva = `${date}-${time}-${score}-${timeElapsed}`;
        
        let hash = 5381;
        for (let i = 0; i < dadosProva.length; i++) {
            hash = ((hash << 5) + hash) + dadosProva.charCodeAt(i);
        }
        
        const hashString = Math.abs(hash).toString(36).toUpperCase().padStart(8, 'X');
        const timeHex = timeElapsed.toString(16).toUpperCase();
        const scoreHex = parseInt(score).toString(16).toUpperCase().padStart(2, '0');
        const authCode = `AUTH-${timeHex}-${scoreHex}-${hashString}`;

        doc.setFillColor(37, 99, 235);
        doc.rect(0, 0, 210, 40, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(22);
        doc.text("Comprovante de Realiza√ß√£o", 105, 20, null, null, "center");
        doc.setFontSize(12);
        doc.text("Avalia√ß√£o: Arduino e Rota√ß√£o por Esta√ß√µes", 105, 30, null, null, "center");

        doc.setDrawColor(200, 200, 200);
        doc.setFillColor(245, 247, 250);
        doc.roundedRect(20, 50, 170, 80, 3, 3, 'FD');

        doc.setTextColor(60, 60, 60);
        doc.setFontSize(12);
        doc.setFont("helvetica", "bold");
        doc.text("Aluno:", 30, 65);
        doc.setFont("helvetica", "normal");
        doc.text(name, 60, 65);

        doc.setFont("helvetica", "bold");
        doc.text("Turma:", 30, 75);
        doc.setFont("helvetica", "normal");
        doc.text(turma, 60, 75);

        doc.setFont("helvetica", "bold");
        doc.text("Data/Hora:", 30, 85);
        doc.setFont("helvetica", "normal");
        doc.text(`${date} √†s ${time}`, 60, 85);
        
        const timerText = document.getElementById('timer-display').textContent.replace(" (FIM)", "");
        doc.setFont("helvetica", "bold");
        doc.text("Tempo de Prova:", 30, 95);
        doc.setFont("helvetica", "normal");
        doc.text(timerText + " / 30:00", 70, 95);

        doc.setFont("helvetica", "bold");
        doc.text("Infra√ß√µes Detectadas:", 30, 105);
        
        if (penaltyCount > 0) {
            doc.setTextColor(220, 38, 38);
        } else {
            doc.setTextColor(22, 163, 74);
        }
        doc.text(`${penaltyCount} de ${MAX_PENALTIES}`, 80, 105);
        doc.setTextColor(60, 60, 60);

        doc.setFontSize(16);
        doc.setFont("helvetica", "bold");
        doc.text("Nota Final:", 30, 120);
        
        doc.setFontSize(24);
        if (parseInt(score) >= 60) {
            doc.setTextColor(22, 163, 74);
        } else {
            doc.setTextColor(220, 38, 38);
        }
        doc.text(`${score}/100`, 70, 120);

        doc.setTextColor(100, 100, 100);
        doc.setFontSize(10);
        doc.setFont("courier", "normal");
        doc.text("C√≥digo de Verifica√ß√£o:", 105, 145, null, null, "center");
        doc.setFontSize(14);
        doc.setFont("courier", "bold");
        doc.text(authCode, 105, 153, null, null, "center");

        doc.setFontSize(8);
        doc.setFont("helvetica", "normal");
        doc.setTextColor(150, 150, 150);
        doc.text("Este c√≥digo √© √∫nico e gerado matematicamente com base na data, hora, nota e tempo de prova.", 105, 165, null, null, "center");
        doc.text("Qualquer altera√ß√£o visual neste documento invalidar√° o c√≥digo de autentica√ß√£o.", 105, 170, null, null, "center");

        doc.save(`Comprovante_${name.replace(/ /g, "_")}.pdf`);
    }
</script>

</body>
</html>